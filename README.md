# Сервис бронирования отелей

Приложение для управления отелями, комнатами и бронированиями с системой рекомендаций.

## Технологии
- **Backend**: Python 3.12, FastAPI
- **База данных**: PostgreSQL
- **ORM**: SQLModel
- **Аутентификация**: JWT
- **Деплой**: Docker

---

##  Установка и работа
1) Скопировать проект 
2) Установить Docker 
3) Сборка и запуск проекта: `docker-compose up --build`
4) Проект будет запущен по адресу: `localhost:81`
5) Документация к проекту: `localhost:81/docs`
6) Тестирование запросов через postman (в проекте есть json с тестами HotelBookingApp.postman_collection.json)
7) Сгенерировать отчет о качестве кода: `pylint app > pylint.txt`

---

## Структура данных

<img src="/doc/er.png" width="500" alt="ER-диаграмма">

*Рис. 1: ER-диаграмма базы данных*

### Сущности
| Сущность      | Поля                                                                 | Описание                     |
|---------------|----------------------------------------------------------------------|------------------------------|
| **User**      | user_id (PK), email, password, name                                 | Пользователи системы         |
| **Hotel**     | id (PK), name, location, rating, price_per_night, distance_from_center | Отели                        |
| **Room**      | id (PK), capacity, price_per_night, hotel (FK → Hotel)              | Номера отелей                |
| **Booking**   | id (PK), check_in, check_out, user_id (FK → User), room_id (FK → Room) | Бронирования                |


---

## Аутентификация

Для работы с защищенными эндпоинтами необходимо добавить токен аутентификации, полученный после входа в систему

---

## API-Эндпоинты

### Аутентификация
| Метод | Путь               | Описание                      |
|-------|--------------------|-------------------------------|
| POST  | `/v1/auth/login`   | Вход в систему                |
| POST  | `/v1/auth/register`| Регистрация нового пользователя |

### Отели
| Метод | Путь                   | Описание                      |
|-------|------------------------|-------------------------------|
| POST  | `/v1/hotels/`          | Добавить отель (требуется аутентификация) |
| GET   | `/v1/hotels/`          | Список всех отелей            |
| GET   | `/v1/hotels/{hotel_id}`| Получить отель по ID          |
| PATCH | `/v1/hotels/{hotel_id}`| Обновить данные отеля         |
| DELETE| `/v1/hotels/{hotel_id}`| Удалить отель                 |

### Рекомендации
| Метод | Путь                   | Описание                      |
|-------|------------------------|-------------------------------|
| POST  | `/v1/hotels/recommendations` | Рекомендации отелей (веса: цена, рейтинг, расстояние) |

### Комнаты
| Метод | Путь                           | Описание                      |
|-------|--------------------------------|-------------------------------|
| POST  | `/v1/rooms/`                   | Добавить номер                |
| GET   | `/v1/rooms/{room_id}`          | Получить номер по ID          |
| PATCH | `/v1/rooms/{room_id}`          | Обновить данные номера        |
| DELETE| `/v1/rooms/{room_id}`          | Удалить номер                 |

### Бронирования
| Метод | Путь                   | Описание                      |
|-------|------------------------|-------------------------------|
| POST  | `/v1/bookings/`        | Создать бронирование          |
| GET   | `/v1/bookings/{booking_id}` | Получить бронирование по ID |
| PATCH | `/v1/bookings/{booking_id}` | Обновить бронирование      |
| DELETE| `/v1/bookings/{booking_id}` | Удалить бронирование      |

---

## Примеры запросов

### Создание отеля
```http
POST /v1/hotels/
Authorization: Bearer eyJhbGci...
Content-Type: application/json

{
  "name": "Grand Hotel",
  "location": "Paris",
  "rating": 4.8,
  "price_per_night": 300.0,
  "distance_from_center": 1.2
}
```

Бизнес логика:
1) Рекомендация отелей на основе пользовательских предпочтений (цена, рейтинг, расстояние от центра).
2) Пользователь указывает веса для параметров (например, price_weight=0.5, rating_weight=0.3, distance_weight=0.2).
Для каждого отеля вычисляется рейтинговая оценка по формуле:
```
score = (price_weight * нормализованная_цена) + 
        (rating_weight * рейтинг) + 
        (distance_weight * нормализованное_расстояние)
```
3) Отели сортируются по убыванию score.

```

В Postman выбираем Headers -> KEY Authorization -> Value:
```
Bearer <Тут указать токен>
```